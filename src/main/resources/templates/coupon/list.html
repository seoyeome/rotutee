<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <title>Table V04</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/sy/fonts/font-awesome-4.7.0/css/font-awesome.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/sy/vendor/animate/animate.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/sy/vendor/select2/select2.min.css}">

    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/sy/css/util.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/sy/css/main.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/hg/css/coupon.css}">
    <!-- font-family -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <!--Jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        tr:hover {
            background-color: #F5F5F5;
        }

        .pagebtn {

            background-color: #D1E4FA !important;
        }

        .pagebtn:focus {
            background-color: #8397D7;
        }

        .categorybtn {
            background-color: #F0F2FF;
        }

        .categorybtn:focus {
            background-color: #8397D7;
        }

        .tablewrap {
            padding-top: 60px;
        }

        .head {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 20px;
        }

        #myTab {
            font-family: 'Noto Sans KR', sans-serif;
            width: 77%;
        }

        #exampleModal {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .selectBox {
            height: 30px;
            display: flex;
            align-content: center;
            margin-top: 20px;

        }

        .search-btn {
            background-color: #8DB6E7 !important;
            color: white !important;
            width: 70px;
            height: 35px;
            font-size: 12px !important;
            padding: 0 !important;
        }

        #search-box {
            border: solid 1px;
        }

        .modal-withdraw {
            display: none;
        }

    </style>
</head>
<body>
<div th:include="/common/adminsidebar.html"></div>
<main>
    <section>
        <span class="section-title">쿠폰발행</span>
        <hr class="mb-md-5">
        <div class="container">
            <table style="box-shadow: 0 2px 4px 0 rgb(0 0 0 / 8%);">

                <thead>
                <tr class="coupon-thead text-center">
                    <th>쿠폰선택</th>
                    <th>쿠폰명</th>
                    <th>쿠폰내용</th>
                    <th>쿠폰생성일자</th>
                    <th>할인률</th>
                    <th>사용기간</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="coupon:${couponList}" class="coupon-tbody text-center" id="couponList">
                    <td>
                        <input id="couponNo" name="couponNo" type="checkbox" th:value="${coupon.couponNo}"
                               style="margin: auto; transform: scale(1.5);">
                    </td>
                    <td th:text="${coupon.couponName}"></td>
                    <td th:text="${coupon.couponContent}"></td>
                    <td th:text="${coupon.couponRegistDate}"></td>
                    <td th:text="${coupon.discountRate}"></td>
                    <td th:text="${coupon.expirationDate}"></td>
                    <td>
                        <button type="button" class="btn" data-bs-toggle="modal"
                                data-bs-target="#couponModifyModal" name="couponModifyButton" )>쿠폰변경
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
            <ul class="d-flex">
                <li>
                    <button class="btn" data-bs-toggle="modal"
                            data-bs-target="#couponRegistModal">쿠폰등록
                    </button>
                </li>
                <li>
                    <button class="btn" type="button" onclick="couponRemove()">쿠폰삭제</button>
                </li>
                <li>
                    <button class="btn" data-bs-toggle="modal"
                            data-bs-target="#couponPublishModal" onclick="publishCouponList()">쿠폰발행
                    </button>
                </li>
            </ul>
        </div>
    </section>

    <hr>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="limiter">
            </div>
        </div>
    </div>
    <!--paging button-->
    <!--        <div class="d-flex justify-content-center">-->
    <!--            <div class="justify-content-evenly mt-lg-5">-->
    <!--                <button class="btn pagebtn" type="button"-->
    <!--                        th:onclick="'location.href=\'/lecturenotice/list?page=' + @{${paging.startPage}}  + '\''"-->
    <!--                        th:disabled="${ notices.first }"><<-->
    <!--                </button>-->
    <!--                <button class="btn pagebtn" type="button"-->
    <!--                        th:onclick="'location.href=\'/lecturenotice/list?page=' + @{${paging.currentPage - 1}}  + '\''"-->
    <!--                        th:disabled="${ notices.first }"><-->
    <!--                </button>-->
    <!--                <th:block th:each="page : ${#numbers.sequence(paging.startPage, paging.endPage)}">-->
    <!--                    <button class="btn pagebtn" type="button"-->
    <!--                            th:onclick="'location.href=\'/lecturenotice/list?page=' + @{${page}}  + '\''"-->
    <!--                            th:text="${ page }"-->
    <!--                            th:disabled="${ paging.currentPage eq page }">-->
    <!--                    </button>-->
    <!--                </th:block>-->
    <!--                <button class="btn pagebtn" type="button"-->
    <!--                        th:onclick="'location.href=\'/lecturenotice/list?page=' + @{${paging.currentPage + 1}}  + '\''"-->
    <!--                        th:disabled="${ notices.last }">>-->
    <!--                </button>-->
    <!--                <button class="btn pagebtn" type="button"-->
    <!--                        th:onclick="'location.href=\'/lecturenotice/list?page=' + @{${paging.endPage}}  + '\''"-->
    <!--                        th:disabled="${ notices.last }">>>-->
    <!--                </button>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        &lt;!&ndash; Search bar &ndash;&gt;-->
    <!--        <form th:action="@{/lecturenotice/list}" method="get">-->
    <!--            <div class="selectBox d-flex justify-content-center">-->
    <!--                <select name="searchCondition">-->
    <!--                    <option value="title">제목</option>-->
    <!--                </select>-->
    <!--                <input id="search-box" type="text" placeholder="검색어입력" name="searchValue">-->
    <!--                <button class="btn search-btn">검색하기</button>-->
    <!--            </div>-->
    <!--        </form>-->
</main>


<!--<main>-->
<!--    <div class="d-flex">-->
<!--        <div class="container coupon-content">-->
<!--            <div>-->
<!--                <h2 class="fs-3">쿠폰 목록</h2>-->
<!--            </div>-->

<!--            <hr>-->

<!--            <ul class="d-flex">-->
<!--                <li>-->
<!--                    <button class="btn" data-bs-toggle="modal"-->
<!--                            data-bs-target="#couponRegistModal">쿠폰등록-->
<!--                    </button>-->
<!--                </li>-->
<!--                <li>-->
<!--                    <button class="btn" type="button" onclick="couponRemove()">쿠폰삭제</button>-->
<!--                </li>-->
<!--                <li>-->
<!--                    <button class="btn" data-bs-toggle="modal"-->
<!--                            data-bs-target="#couponPublishModal" onclick="publishCouponList()">쿠폰발행-->
<!--                    </button>-->
<!--                </li>-->
<!--            </ul>-->

<!--            <table class="table table-hover">-->
<!--                <thead>-->
<!--                <td>선택</td>-->
<!--                <td>쿠폰명</td>-->
<!--                <td>쿠폰내용</td>-->
<!--                <td>쿠폰등록일자</td>-->
<!--                <td>할인률</td>-->
<!--                <td>사용기간</td>-->
<!--                <td></td>-->
<!--                </thead>-->

<!--                <tbody>-->
<!--                <tr th:each="coupon:${couponList}" id="couponList">-->
<!--                    <td>-->
<!--                        <input id="couponNo" name="couponNo" type="checkbox" th:value="${coupon.couponNo}">-->
<!--                    </td>-->
<!--                    <td th:text="${coupon.couponName}"></td>-->
<!--                    <td th:text="${coupon.couponContent}"></td>-->
<!--                    <td th:text="${coupon.couponRegistDate}"></td>-->
<!--                    <td th:text="${coupon.discountRate}"></td>-->
<!--                    <td th:text="${coupon.expirationDate}"></td>-->
<!--                    <td>-->
<!--                        <button type="button" class="btn" data-bs-toggle="modal"-->
<!--                                data-bs-target="#couponModifyModal" name="couponModifyButton" )>쿠폰변경-->
<!--                        </button>-->
<!--                    </td>-->
<!--                </tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </div>-->
<!--    </div>-->
<!--</main>-->

<div th:include="/common/footer.html"></div>


<!-- Modal -->
<div class="modal fade" id="couponRegistModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <div class="modal-header">
                <h2>쿠폰 등록</h2>
            </div>

            <div class="modal-body">
                <form action="/coupon/regist" method="post" id="couponRegistForm">
                    <div class="d-flex flex-md-column">

                        <div class="col-md-6 shadow-sm mb-md-3 w-100">
                            <label class="fw-bold">쿠폰명</label>
                            <div class="d-flex">
                                <input class="tag-input w-100" type="text" name="couponName">
                            </div>
                        </div>

                        <div class="col-md-6 shadow-sm mb-md-3 w-100">
                            <label class="fw-bold">쿠폰내용</label>
                            <div class="d-flex">
                                <input class="tag-input w-100" type="text" name="couponContent">
                            </div>
                        </div>

                        <div class="col-md-12 shadow-sm mb-md-3 w-100">
                            <label class="fw-bold">할인율</label>
                            <div class="d-flex">
                                <input class="tag-input w-100" type="text" name="discountRate">
                            </div>
                        </div>

                        <div class="col-md-12 shadow-sm mb-md-3  w-100">
                            <label class="fw-bold">만료기한</label>
                            <div class="d-flex">
                                <input class="tag-input w-100" type="text" name="expirationDate">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <div class="d-flex">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
                        취소
                    </button>
                    <button type="submit" class="btn btn-outline-primary" form="couponRegistForm">
                        등록
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="couponModifyModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <div class="modal-header">
                <h2>쿠폰변경</h2>
            </div>

            <div class="modal-body">
                <form action="/coupon/modify" method="post" id="couponModifyForm">
                    <div class="d-flex flex-md-column">

                        <div class="col-md-6 shadow-sm mb-md-3 w-100">
                            <label class="fw-bold">쿠폰명</label>
                            <div class="d-flex">
                                <input type="hidden" id="modifyCouponNo" val="" name="couponNo">
                                <input class="tag-input w-100" type="text" id="modifyCouponName" name="couponName">
                            </div>
                        </div>

                        <div class="col-md-6 shadow-sm mb-md-3 w-100">
                            <label class="fw-bold">쿠폰내용</label>
                            <div class="d-flex">
                                <input class="tag-input w-100" type="text" id="modifyCouponContent"
                                       name="couponContent">
                            </div>
                        </div>

                        <div class="col-md-12 shadow-sm mb-md-3 w-100">
                            <label class="fw-bold">할인율</label>
                            <div class="d-flex">
                                <input class="tag-input w-100" type="text" id="modifyDiscountRate" name="discountRate">
                            </div>
                        </div>

                        <div class="col-md-12 shadow-sm mb-md-3  w-100">
                            <label class="fw-bold">만료기한</label>
                            <div class="d-flex">
                                <input class="tag-input w-100" type="text" id="modifyExpirationDate"
                                       name="expirationDate">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <div class="d-flex">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
                        취소
                    </button>
                    <button type="submit" class="btn btn-outline-primary" form="couponModifyForm">
                        등록
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="couponPublishModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">

            <div class="modal-header">
                <h2>쿠폰변경</h2>
            </div>

            <div class="modal-body">
                <form action="/coupon/publish" method="post" id="couponPublishForm">
                    <div>
                        <button>회원전체 발행</button>
                        <button>개인회원 발행</button>
                    </div>
                    <ul id="publishCouponList"></ul>
                </form>
            </div>

            <div class="modal-footer">
                <div class="d-flex">

                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
                        취소
                    </button>
                    <button type="submit" class="btn btn-outline-primary" form="couponPublishForm">
                        발행
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>


<script th:inline="javascript">
</script>
<!--===============================================================================================-->
<!--<script th:src="@{/sy/vendor/bootstrap/js/popper.js}"></script>-->
<!--<script th:src="@{/sy/vendor/bootstrap/js/bootstrap.min.js}"></script>-->
<!--===============================================================================================-->
<script th:src="@{/sy/vendor/select2/select2.min.js}"></script>
<!--===============================================================================================-->


<!--===============================================================================================-->
<script th:src="@{/sy/js/main.js}"></script>


<script>


    function couponRemove() {

        let couponArray = [];

        $("input:checkbox[name=couponNo]:checked").each(function () {

            couponArray.push(($(this).val()));

            console.log(couponArray);
        });


        $.ajax({
            url: "/coupon/remove",
            type: "post",
            data: {"couponArray": couponArray},
            success: function (data) {
                alert("성공");

                if ($("input:checkbox[name=couponNo]:checked")) {
                    $("input:checkbox[name=couponNo]:checked").each(function () {
                        $(this).closest("tr").remove();
                    });
                }

            },
            error: function (data) {
                alert("실패");

            }
        });
    };


    $("button[name=couponModifyButton]").on("click", function () {

        const thisRow = $(this).closest("tr");
        const couponNo = thisRow.find("td:eq(0)").find("input").val();
        const couponName = thisRow.find("td:eq(1)").html();
        const couponContent = thisRow.find("td:eq(2)").html();
        const couponDiscountRate = thisRow.find("td:eq(4)").html();
        const couponExpirationDate = thisRow.find("td:eq(5)").html();

        $("#modifyCouponNo").val(couponNo);
        $("#modifyCouponName").val(couponName);
        $("#modifyCouponContent").val(couponContent);
        $("#modifyDiscountRate").val(couponDiscountRate);
        $("#modifyExpirationDate").val(couponExpirationDate);

    });

    function publishCouponList() {

        const coupons = [];

        $("input:checkbox[name=couponNo]:checked").each(function () {

            const thisRow = $(this).closest("tr");

            const couponNo = thisRow.find("td:eq(0)").find("input").val();
            const couponName = thisRow.find("td:eq(1)").html();

            coupons.push({no: couponNo, name: couponName})

        });

        coupons.map((coupon) => {

            $("#publishCouponList").append("<li class='publish-coupon-item'>" + "<input type='hidden' name='couponNo' value='" + coupon.no + "'>" + coupon.name + "</li>");
        });
    };


</script>
</body>
</html>