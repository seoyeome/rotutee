<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <table>
        <tr>
            <th>글번호</th>
            <th>제목</th>
            <th>작성일</th>
            <th>작성자</th>
            <th>조회수</th>
            <th>내용</th>
        </tr>
        <tr>
            <td th:text="${ detailBoard.no }"></td>
            <td th:text="${ detailBoard.title }"></td>
            <td th:text="${ detailBoard.creationDate }"></td>
            <td th:text="${ detailBoard.member.name }"></td>
            <td th:text="${ detailBoard.viewCount }"></td>
            <td th:text="${ detailBoard.content }"></td>
        </tr>
    </table>
    <table id="answer-table">
        <tr>
            <th>여러분의 소중한 댓글을 남겨주세요.</th>
        </tr>
        <tr th:each="answer : ${ detailBoard.boardAnswerList }">
            <td th:text="${ answer.content }"></td>
            <td th:text="${ answer.member.name }"></td>
            <td th:text="${ answer.createdDate }"></td>
<!--            <th:block th:if=" ${ answer.member.no } ==  ${ #authentication.principal.no }">-->
                <td>
                    <button>수정</button>
                    <button>삭제</button>
                </td>
<!--            </th:block>-->
        </tr>
        <tbody>
        </tbody>
    </table>
    <input type="text" id="answer" name="answer"> <button type="button" id="registAnswerBtn">등록</button>
    <script>

        $("#registAnswerBtn").click(function() {

            let boardNo = "[[${ detailBoard.no }]]";
            let answer = $("#answer").val();

            alert(boardNo + answer);


            $.ajax({
                url: "/serviceBoard/registAnswer",
                type: "post",
                data: { "boardNo" : boardNo, "answer" : answer },
                success: function(data) {

                    const $table = $("#answer-table");
                    const $tr = $("<tr>");
                    const $content = $("<td>").text(data.content);
                    const $name = $("<td>").text(data.member.name);
                    const $createdDate = $("<td>").text(data.createdDate);

                    $table.append($tr);
                    $tr.append($content);
                    $tr.append($name);
                    $tr.append($createdDate);

                    alert("성공맨");
                }
            });
        });
    </script>
</body>
</html>